{
	"info": {
		"_postman_id": "d88d3af1-d273-4675-a84a-bf6577d283ca",
		"name": "collection2",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "36365267"
	},
	"item": [
		{
			"name": "Get all user 200",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Check if the response is 200\r",
							"pm.test(\"Status code is 200\", () => {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"// Check if the response time is less than 200ms\r",
							"pm.test(\"Response time is less than 200ms\", () => { \r",
							"    pm.expect(pm.response.responseTime).to.be.below(200);\r",
							"});\r",
							"\r",
							"const questions = pm.response.json();\r",
							"\r",
							"// Check if the response is an array of questions\r",
							"pm.test(\"Response is an array\", () => {\r",
							"    pm.expect(questions).to.be.an('array');\r",
							"});\r",
							"\r",
							"// EDGE-CASE: Handle empty array scenario\r",
							"if (questions.length === 0) {\r",
							"    pm.test(\"Empty array is acceptable\", () => {\r",
							"        pm.expect(questions).to.be.an('array').that.is.empty;\r",
							"        console.log(\"Database is empty - this is valid\");\r",
							"    });\r",
							"} else {\r",
							"    pm.test(\"Array has at least one question\", () => {\r",
							"        pm.expect(questions.length).to.be.greaterThan(0);\r",
							"    });\r",
							"}\r",
							"\r",
							"// Check if each question has the required fields\r",
							"pm.test(\"Each question has required fields\", () => {\r",
							"    questions.forEach(question => {\r",
							"        pm.expect(question).to.have.property('id');\r",
							"        pm.expect(question).to.have.property('question');\r",
							"        pm.expect(question).to.have.property('options');\r",
							"        pm.expect(question).to.have.property('correctAnswer');\r",
							"        pm.expect(question).to.have.property('difficulty');\r",
							"    });\r",
							"});\r",
							"\r",
							"// SALVE first id\r",
							"if (questions.length > 0) {\r",
							"    // choose first id \r",
							"    const questionId = questions[0].id;\r",
							"    \r",
							"    // save first id to collection variable for later use in other tests\r",
							"    pm.collectionVariables.set(\"questionId\", questionId);\r",
							"    \r",
							"    console.log(\" Saved test ID: \" + questionId + \" (\" + questions[0].question.substring(0, 20) + \"...)\");\r",
							"} else {\r",
							"    console.log(\"No questions found - will need to create one first\");\r",
							"    pm.collectionVariables.set(\"questionId\", null);\r",
							"}\r",
							"\r",
							"\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-role",
						"value": "user",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:3000/api/questions",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions"
					]
				}
			},
			"response": []
		},
		{
			"name": "Post admin 201 created",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Parse response body to JSON",
							"const question = pm.response.json();",
							"",
							"// 1. Status code is 201 (Created)",
							"pm.test(\"Status code is 201\", () => {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"// 2. Response is an object",
							"pm.test(\"Response is an object\", () => {",
							"    pm.expect(question).to.be.an('object');",
							"});",
							"",
							"// 3. Question has all required fields",
							"pm.test(\"Question has required fields\", () => {",
							"    pm.expect(question).to.have.property('id');",
							"    pm.expect(question).to.have.property('question');",
							"    pm.expect(question).to.have.property('options');",
							"    pm.expect(question).to.have.property('correctAnswer');",
							"    pm.expect(question).to.have.property('difficulty');",
							"});",
							"",
							"// 4. Difficulty is what we sent (e.g., \"medium\", \"hard\", \"easy\")",
							"pm.test(\"Difficulty is correct\", () => {",
							"    const requestBody = JSON.parse(pm.request.body.raw);",
							"    pm.expect(question.difficulty).to.eql(requestBody.difficulty);",
							"});",
							"",
							"// 5. Correct answer is in options",
							"pm.test(\"Correct answer exists in options\", () => {",
							"    pm.expect(question.options).to.include(question.correctAnswer);",
							"});",
							"",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "x-role",
						"value": "admin",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"question\": \"What is 1+1\",\n    \"options\": [\n      \"2\",\"3\",\"4\"\n    ],\n    \"correctAnswer\": \"2\",\n    \"difficulty\": \"easy\"\n  }\n\n\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "http://localhost:3000/api/questions",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions"
					]
				},
				"description": "This is a POST request, submitting data to an API via the request body. This request submits JSON data, and the data is reflected in the response.\n\nA successful POST request typically returns a `200 OK` or `201 Created` response code."
			},
			"response": []
		},
		{
			"name": "Get by id admin 200",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.collectionVariables.set(\"questionId\", 11);\r",
							"console.log(\"Preparing to get question ID: 11 for patch\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"const status = pm.response.code;\r",
							"\r",
							"// Check if the status code is 200 or 404.\r",
							"pm.test(\"Status code is 200 or 404\", () => {\r",
							"    pm.expect([200, 404]).to.include(status);\r",
							"});\r",
							"\r",
							"// Check if the response body is correct when status code is 200.\r",
							"if (status === 200) {\r",
							"    const data = pm.response.json();\r",
							"\r",
							"    pm.test(\"Question returned correctly\", () => {\r",
							"        pm.expect(data).to.have.property(\"id\");\r",
							"        pm.expect(data.id).to.eql(\r",
							"            parseInt(pm.collectionVariables.get(\"questionId\"))\r",
							"        );\r",
							"        pm.expect(data).to.have.property(\"question\");\r",
							"        pm.expect(data).to.have.property(\"options\");\r",
							"        pm.expect(data).to.have.property(\"correctAnswer\");\r",
							"        pm.expect(data).to.have.property(\"difficulty\");\r",
							"    });\r",
							"\r",
							"// check if we had de correct status code 404 and message\r",
							"} else if (status === 404) {\r",
							"    const error = pm.response.json();\r",
							"\r",
							"    pm.test(\"Question not found message is correct\", () => {\r",
							"        pm.expect(error).to.have.property(\"message\");\r",
							"        pm.expect(error.message).to.eql(\"Question not found\");\r",
							"    });\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-role",
						"value": "admin",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:3000/api/questions/{{questionId}}",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions",
						"{{questionId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Patch by id admin 200",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.collectionVariables.set(\"questionId\", 11);\r",
							"console.log(\"Preparing to patch question ID: 11\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"// 1. Status code is 200\r",
							"pm.test(\"Status code is 200\", () => {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"// 2. Parse response\r",
							"const updatedQuestion = pm.response.json();\r",
							"\r",
							"// 3. Verify only difficulty changed\r",
							"pm.test(\"Only difficulty field was updated\", () => {\r",
							"    // Difficulty should be new value\r",
							"    pm.expect(updatedQuestion.difficulty).to.eql(\"hard\");\r",
							"});\r",
							"\r",
							"// 4. ID should remain the same\r",
							"pm.test(\"ID remains unchanged after PATCH\", () => {\r",
							"    const questionId = parseInt(pm.collectionVariables.get(\"questionId\"));\r",
							"    pm.expect(updatedQuestion.id).to.eql(questionId);\r",
							"});\r",
							"\r",
							"// 5. Other fields should still exist\r",
							"pm.test(\"Other fields are still present\", () => {\r",
							"    pm.expect(updatedQuestion).to.have.property('question');\r",
							"    pm.expect(updatedQuestion).to.have.property('options');\r",
							"    pm.expect(updatedQuestion).to.have.property('correctAnswer');\r",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "x-role",
						"value": "admin",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"difficulty\": \"hard\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "http://localhost:3000/api/questions/{{questionId}}",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions",
						"{{questionId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get by id admin 200",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.collectionVariables.set(\"questionId\", 11);\r",
							"console.log(\"Preparing to delete question ID: 11\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"const status = pm.response.code;\r",
							"\r",
							"// Check if the status code is 200 or 404.\r",
							"pm.test(\"Status code is 200 or 404\", () => {\r",
							"    pm.expect([200, 404]).to.include(status);\r",
							"});\r",
							"\r",
							"// Check if the response body is correct when status code is 200.\r",
							"if (status === 200) {\r",
							"    const data = pm.response.json();\r",
							"\r",
							"    pm.test(\"Question returned correctly\", () => {\r",
							"        pm.expect(data).to.have.property(\"id\");\r",
							"        pm.expect(data.id).to.eql(\r",
							"            parseInt(pm.collectionVariables.get(\"questionId\"))\r",
							"        );\r",
							"        pm.expect(data).to.have.property(\"question\");\r",
							"        pm.expect(data).to.have.property(\"options\");\r",
							"        pm.expect(data).to.have.property(\"correctAnswer\");\r",
							"        pm.expect(data).to.have.property(\"difficulty\");\r",
							"    });\r",
							"\r",
							"// check if had the coorect message and status code when 404\r",
							"} else if (status === 404) {\r",
							"    const error = pm.response.json();\r",
							"\r",
							"    pm.test(\"Question not found message is correct\", () => {\r",
							"        pm.expect(error).to.have.property(\"message\");\r",
							"        pm.expect(error.message).to.eql(\"Question not found\");\r",
							"    });\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "x-role",
						"value": "admin",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:3000/api/questions/{{questionId}}",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions",
						"{{questionId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete by id admin 200",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"pm.collectionVariables.set(\"questionId\", 11);\r",
							"console.log(\"Preparing to delete question ID: 11\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Get the expected ID that we tried to delete\r",
							"const expectedId = parseInt(pm.collectionVariables.get(\"questionId\"));\r",
							"const status = pm.response.code;\r",
							"\r",
							"// Test 1: Check for acceptable status codes\r",
							"pm.test(\"Status code is 200 or 404\", () => {\r",
							"    pm.expect([200, 404]).to.include(status);\r",
							"});\r",
							"\r",
							"if (status === 200) {\r",
							"    // SUCCESS CASE: Question was deleted\r",
							"    const deletedQuestion = pm.response.json();\r",
							"    \r",
							"    pm.test(\"Deleted question ID matches request\", () => {\r",
							"        pm.expect(deletedQuestion.id).to.eql(expectedId);\r",
							"    });\r",
							"    \r",
							"    pm.test(\"Deleted question has all fields\", () => {\r",
							"        pm.expect(deletedQuestion).to.have.property('id');\r",
							"        pm.expect(deletedQuestion).to.have.property('question');\r",
							"        pm.expect(deletedQuestion).to.have.property('options');\r",
							"        pm.expect(deletedQuestion).to.have.property('correctAnswer');\r",
							"        pm.expect(deletedQuestion).to.have.property('difficulty');\r",
							"    });\r",
							"    \r",
							"    console.log(`Successfully deleted question ID: ${expectedId}`);\r",
							"    \r",
							"} else if (status === 404) {\r",
							"    // ERROR CASE: Question didn't exist\r",
							"    const error = pm.response.json();\r",
							"    \r",
							"    pm.test(\"Question not found message\", () => {\r",
							"        pm.expect(error).to.have.property(\"message\");\r",
							"        pm.expect(error.message).to.eql(\"Question not found\");\r",
							"    });\r",
							"    \r",
							"    console.log(`Correctly got 404 - question ${expectedId} didn't exist`);\r",
							"}"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "x-role",
						"value": "admin",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:3000/api/questions/{{questionId}}",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "3000",
					"path": [
						"api",
						"questions",
						"{{questionId}}"
					]
				}
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "questionId",
			"value": ""
		}
	]
}